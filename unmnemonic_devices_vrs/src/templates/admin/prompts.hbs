{{#> admin/layout}}
  {{#each prompts as |value character_name|}}
    <h2 data-character="{{character_name}}">{{character_name}}</h2>
    <table data-character="{{character_name}}">
      <tbody>
        {{#each value as |prompt_text_and_maybe_url prompt_name|}}
          <tr>
            <td><code>{{prompt_name}}</code></td>
            <td>{{prompt_text_and_maybe_url.[0]}}</td>
            {{#if prompt_text_and_maybe_url.[1]}}
              <td><audio controls src="{{prompt_text_and_maybe_url.[1]}}"></audio></td>
            {{else}}
              <td>⚠️</td>
            {{/if}}
          </tr>
        {{/each}}
      </tbody>
    </table>
  {{/each}}
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      document.querySelectorAll('table[data-character]').forEach(function(table) {
        let header = document.querySelector(`h2[data-character='${table.dataset.character}']`);

        header.insertAdjacentHTML('beforeend', `<button onclick="playAllFor('${table.dataset.character}')">Play all</button>`);
      });
    });

    // Adapted from https://stackoverflow.com/a/69305053/760389
    async function playAllFor(character) {
      let sounds = document.querySelectorAll(`table[data-character='${character}'] audio`);

      for (let sound of sounds) {
        let ended = new Promise(resolve =>
          sound.addEventListener("ended", resolve, {once: true})
        );

        sound.play();
        await ended;
      }
    }
  </script>
{{/admin/layout}}
